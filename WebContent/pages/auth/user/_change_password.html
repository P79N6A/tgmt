<fieldset>
	<input type="hidden" name="userid" value="#(user.id??)" />
	
	<div class="am-form-group">
		<div id="tips-msg"></div>
	</div>
	
	#if(user.password??)
	<!-- 当密码已存在时，旧密码框才会出现 -->
	<div class="am-form-group">
		<label for="old-password">(*)旧密码: </label> 
		<input type="password" class="" id="old-password" name="oldpassword" placeholder="输入旧密码">
	</div>
	#end

	<div class="am-form-group">
		<label for="new-one-password">(*)新密码（至少6位）: </label> 
		<input type="password" minlength="6" class="" id="new-one-password" name="newonepassword" 
		placeholder="输入新密码（至少6位）">
	</div>

	<div class="am-form-group">
		<label for="new-dual-password">(*)确认新密码: </label> 
		<input type="password" minlength="6" class="" id="new-dual-password" name="newdualpassword"
		placeholder="请重复输入与上面一致的新密码">
	</div>
	
	<!--begin 提交保存按钮 -->
	<div class="am-form-group">
		<div class="am-u-sm-3">
			<div class="am-input-group am-input-group-sm">
				<button class="am-btn am-btn-primary am-btn-lg am-fl am-radius"
					type="button" onclick="savepswd()">保存</button>
			</div>
		</div>
		<div class="am-u-sm-9">
			<div class="am-btn-group am-btn-group-xs">
				<a href="#(CPATH)/auth/user">
					<button type="button"
						class="am-btn am-btn-primary am-btn-lg am-fl am-radius">
						返回</button>
				</a>
			</div>
		</div>
	</div>
	<!--end 提交保存按钮 -->

</fieldset>
<script type="text/javascript">
<!--

function savepswd() {
	
  $('.am-alert').remove();
  var vOldPwd = '';
  #if(user.password??) 
	vOldPwd = $("#old-password").val();
	if(vOldPwd=="") {
		$("#old-password").after('<div id="oldPasswordErr" class="am-alert am-alert-danger" data-am-alert><button type="button" class="am-close">&times;</button><p>请输入旧密码！</p></div>');
		return;
	}
  #end
  
  var vNewOnePwd = $("#new-one-password").val();
  if(vNewOnePwd=="") {
	$("#new-one-password").after('<div id="newOnePasswordErr" class="am-alert am-alert-danger" data-am-alert><button type="button" class="am-close">&times;</button><p>请输入新密码！</p></div>');
	return;
  } else if(vNewOnePwd.length<6) {
	$("#new-one-password").after('<div id="newOnePasswordErr" class="am-alert am-alert-danger" data-am-alert><button type="button" class="am-close">&times;</button><p>请输入6位以上新密码！</p></div>');
	return;
  }
  
  var vNewDualPwd = $("#new-dual-password").val();
  if(vNewDualPwd != vNewOnePwd) {
	$("#new-dual-password").after('<div id="newDualPasswordErr" class="am-alert am-alert-danger" data-am-alert><button type="button" class="am-close">&times;</button><p>请重复输入与上面一致的新密码！</p></div>');
	return;
  }
  
  $.ajax({
		type: "POST",
		dataType: "text",
		url: "#(CPATH)/auth/user/chgpswd",
		data: {
			'userid':#(user.id),
			'oldpassword': vOldPwd,
			'newonepassword': vNewOnePwd,
			'newdualpassword':vNewDualPwd
		},
		success: function(data){
			if(data=="1"){
				alert("成功修改密码！");
				location.href = "#(CPATH)/auth/user/edit/" + #(user.id);
				return true;
          	}else if(data=="2"){
          		$("#tips-msg").after('<div id="result_msg" class="am-alert am-alert-success" data-am-alert><button type="button" class="am-close">&times;</button><p>成功修改密码！</p></div>');
          		return true;
          	} else {
          		$("#tips-msg").after('<div id="result_msg" class="am-alert am-alert-danger" data-am-alert><button type="button" class="am-close">&times;</button><p>' + data + '</p></div>');
              	return false;
			}
		}
	});
  
  return false;
  
}



//-->
</script>
